[Unit]
Description=HealthArchive worker auto-start watchdog (start worker when down but jobs pending)
Wants=network-online.target
After=network-online.target
ConditionPathExists=/etc/healtharchive/backend.env
ConditionPathExists=/etc/healtharchive/storagebox.env
ConditionPathExists=/etc/healtharchive/worker-auto-start-enabled
ConditionPathExists=/opt/healtharchive-backend/.venv/bin/python3
ConditionPathExists=/opt/healtharchive-backend/scripts/vps-worker-auto-start.py

[Service]
Type=oneshot
User=root
Group=root
EnvironmentFile=/etc/healtharchive/backend.env
ExecStart=/opt/healtharchive-backend/.venv/bin/python3 /opt/healtharchive-backend/scripts/vps-worker-auto-start.py --apply

